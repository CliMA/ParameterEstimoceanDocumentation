<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Private · ParameterEstimocean.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://clima.github.io/ParameterEstimoceanDocumentation/dev/library/internals/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ParameterEstimocean.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation_instructions/">Installation Instructions</a></li><li><a class="tocitem" href="../../literated/intro_to_observations/">Intro to observations</a></li><li><a class="tocitem" href="../../literated/intro_to_inverse_problems/">Intro to inverse problems</a></li><li><a class="tocitem" href="../../literated/exploring_priors/">Exploring Prior distributions</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../literated/perfect_convective_adjustment_calibration/">Perfect convective adjustment calibration with Ensemble Kalman Inversion</a></li><li><a class="tocitem" href="../../literated/single_case_lesbrary_ri_based_calibration/">Calibration of <code>RiBasedVerticalDiffusivity</code> to one LESbrary simulation</a></li><li><a class="tocitem" href="../../literated/multi_case_lesbrary_ri_based_calibration/">Calibration of <code>RiBasedVerticalDiffusivity</code> to five LESbrary simulations</a></li><li><a class="tocitem" href="../../literated/perfect_baroclinic_adjustment_calibration/">Perfect baroclinic adjustment calibration with Ensemble Kalman Inversion</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../outline/">Contents</a></li><li><a class="tocitem" href="../public/">Public</a></li><li class="is-active"><a class="tocitem" href>Private</a><ul class="internal"><li><a class="tocitem" href="#ParameterEstimocean"><span>ParameterEstimocean</span></a></li><li><a class="tocitem" href="#Transformations"><span>Transformations</span></a></li><li><a class="tocitem" href="#Observations"><span>Observations</span></a></li><li><a class="tocitem" href="#Ensemble-Simulations"><span>Ensemble Simulations</span></a></li><li><a class="tocitem" href="#Parameters"><span>Parameters</span></a></li><li><a class="tocitem" href="#Inverse-Problems"><span>Inverse Problems</span></a></li><li><a class="tocitem" href="#EnsembleKalmanInversions"><span>EnsembleKalmanInversions</span></a></li><li><a class="tocitem" href="#PseudoSteppingSchemes"><span>PseudoSteppingSchemes</span></a></li></ul></li><li><a class="tocitem" href="../function_index/">Function index</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Library</a></li><li class="is-active"><a href>Private</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Private</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/main/docs/src/library/internals.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Private-types-and-functions"><a class="docs-heading-anchor" href="#Private-types-and-functions">Private types and functions</a><a id="Private-types-and-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Private-types-and-functions" title="Permalink"></a></h1><p>Documentation for <code>ParameterEstimocean.jl</code>&#39;s internal interface.</p><h2 id="ParameterEstimocean"><a class="docs-heading-anchor" href="#ParameterEstimocean">ParameterEstimocean</a><a id="ParameterEstimocean-1"></a><a class="docs-heading-anchor-permalink" href="#ParameterEstimocean" title="Permalink"></a></h2><h2 id="Transformations"><a class="docs-heading-anchor" href="#Transformations">Transformations</a><a id="Transformations-1"></a><a class="docs-heading-anchor-permalink" href="#Transformations" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Transformations.compute_normalization-Tuple{ZScore{Nothing}, Any, Any}" href="#ParameterEstimocean.Transformations.compute_normalization-Tuple{ZScore{Nothing}, Any, Any}"><code>ParameterEstimocean.Transformations.compute_normalization</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Compute ZScore on time- and space-transformed field time series data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Transformations.jl#L196">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Transformations.compute_time_transformation-Tuple{Nothing, Any}" href="#ParameterEstimocean.Transformations.compute_time_transformation-Tuple{Nothing, Any}"><code>ParameterEstimocean.Transformations.compute_time_transformation</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">compute_time_transformation(user_time_transformation, fts)</code></pre><p>Compute a time transformation for the field time series <code>fts</code> given <code>user_time_transformation</code>.</p><p>By default, if <code>user_time_transformation isa nothing</code>, then we include all time instances except the initial condition.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Transformations.jl#L93-L101">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Transformations.denormalize!-Tuple{Any, ZScore}" href="#ParameterEstimocean.Transformations.denormalize!-Tuple{Any, ZScore}"><code>ParameterEstimocean.Transformations.denormalize!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">denormalize!(data, normalization::ZScore)</code></pre><p>Given some <code>data</code> that has been normalized as specified by <code>normalization</code>, return the data to its original scale by performing the inverse of the  <code>normalize!</code> operation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Transformations.jl#L213-L219">source</a></section></article><h2 id="Observations"><a class="docs-heading-anchor" href="#Observations">Observations</a><a id="Observations-1"></a><a class="docs-heading-anchor-permalink" href="#Observations" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Observations.FieldTimeSeriesCollector-Tuple{Any, Any}" href="#ParameterEstimocean.Observations.FieldTimeSeriesCollector-Tuple{Any, Any}"><code>ParameterEstimocean.Observations.FieldTimeSeriesCollector</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">FieldTimeSeriesCollector(collected_fields, times;
                         architecture = Architectures.architecture(first(collected_fields)))</code></pre><p>Return a <code>FieldTimeSeriesCollector</code> for <code>fields</code> of <code>simulation</code>. <code>fields</code> is a <code>NamedTuple</code> of <code>AbstractField</code>s that are to be collected.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Observations.jl#L353-L359">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Observations.column_ensemble_interior-Tuple{BatchedSyntheticObservations, Any, Any, Any}" href="#ParameterEstimocean.Observations.column_ensemble_interior-Tuple{BatchedSyntheticObservations, Any, Any, Any}"><code>ParameterEstimocean.Observations.column_ensemble_interior</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">column_ensemble_interior(batch::BatchedSyntheticObservations,
                         field_name, time_index, (Nensemble, Nbatch, Nz))</code></pre><p>Return an <code>Nensemble × Nbatch × Nz</code> Array of <code>(1, 1, Nz)</code> <code>field_name</code> data, given <code>Nbatch</code> <code>SyntheticObservations</code> objects. The <code>Nbatch × Nz</code> data for <code>field_name</code> is copied <code>Nensemble</code> times to form a 3D Array.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Observations.jl#L272-L279">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Observations.forward_map_names-Tuple{BatchedSyntheticObservations}" href="#ParameterEstimocean.Observations.forward_map_names-Tuple{BatchedSyntheticObservations}"><code>ParameterEstimocean.Observations.forward_map_names</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">forward_map_names(observations::BatchedSyntheticObservations)</code></pre><p>Return a Set representing the union of all names in <code>observations</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Observations.jl#L201-L205">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Observations.observation_names-Tuple{BatchedSyntheticObservations}" href="#ParameterEstimocean.Observations.observation_names-Tuple{BatchedSyntheticObservations}"><code>ParameterEstimocean.Observations.observation_names</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">observation_names(observations::BatchedSyntheticObservations)</code></pre><p>Return a Set representing the union of all names in <code>observations</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Observations.jl#L208-L212">source</a></section></article><h2 id="Ensemble-Simulations"><a class="docs-heading-anchor" href="#Ensemble-Simulations">Ensemble Simulations</a><a id="Ensemble-Simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Ensemble-Simulations" title="Permalink"></a></h2><h2 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Parameters.closure_with_parameters-Tuple{Any, Any}" href="#ParameterEstimocean.Parameters.closure_with_parameters-Tuple{Any, Any}"><code>ParameterEstimocean.Parameters.closure_with_parameters</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">closure_with_parameters(closure, parameters)</code></pre><p>Return a new object where for each (<code>parameter_name</code>, <code>parameter_value</code>) pair  in <code>parameters</code>, the value corresponding to the key in <code>closure</code> that matches <code>parameter_name</code> is replaced with <code>parameter_value</code>.</p><p><strong>Example</strong></p><p>Create a placeholder <code>Closure</code> type that includes a parameter <code>c</code> and a sub-closure with two parameters: <code>a</code> and <code>b</code>. Then construct a closure with values <code>a, b, c = 1, 2, 3</code>.</p><pre><code class="language-julia-repl hljs">julia&gt; struct Closure; subclosure; c end

julia&gt; struct ClosureSubModel; a; b end

julia&gt; sub_closure = ClosureSubModel(1, 2)
ClosureSubModel(1, 2)

julia&gt; closure = Closure(sub_closure, 3)
Closure(ClosureSubModel(1, 2), 3)</code></pre><p>Providing <code>closure_with_parameters</code> with a named tuple of parameter names and values, and a recursive search in all types and subtypes within <code>closure</code> is done and whenever a parameter is found whose name exists in the named tuple we provided, its value is  then replaced with the value provided.</p><pre><code class="language-julia-repl hljs">julia&gt; new_parameters = (a = 12, d = 7)
(a = 12, d = 7)

julia&gt; using ParameterEstimocean.Parameters: closure_with_parameters

julia&gt; closure_with_parameters(closure, new_parameters)
Closure(ClosureSubModel(12, 2), 3)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Parameters.jl#L471-L510">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Parameters.construct_object-Tuple{Union{Number, AbstractArray}, Any}" href="#ParameterEstimocean.Parameters.construct_object-Tuple{Union{Number, AbstractArray}, Any}"><code>ParameterEstimocean.Parameters.construct_object</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">construct_object(specification_dict, parameters; name=nothing, type_parameter=nothing)

construct_object(d::ParameterValue, parameters; name=nothing)</code></pre><p>Return a composite type object whose properties are prescribed by the <code>specification_dict</code> dictionary. All parameter values are given the values in <code>specification_dict</code> <em>unless</em> they are included as a parameter name-value pair in the named tuple <code>parameters</code>, in which case the value in <code>parameters</code> is asigned.</p><p>The <code>construct_object</code> is recursively called upon every property that is included in <code>specification_dict</code> until a property with a numerical value is reached. The object&#39;s constructor name must be included in <code>specification_dict</code> under key <code>:type</code>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using ParameterEstimocean.Parameters: construct_object, dict_properties, closure_with_parameters

julia&gt; struct Closure; subclosure; c end

julia&gt; struct ClosureSubModel; a; b end

julia&gt; sub_closure = ClosureSubModel(1, 2)
ClosureSubModel(1, 2)

julia&gt; closure = Closure(sub_closure, 3)
Closure(ClosureSubModel(1, 2), 3)

julia&gt; specification_dict = dict_properties(closure)
Dict{Symbol, Any} with 3 entries:
  :type       =&gt; Closure
  :c          =&gt; 3
  :subclosure =&gt; Dict{Symbol, Any}(:a=&gt;1, :b=&gt;2, :type=&gt;ClosureSubModel)

julia&gt; new_closure = construct_object(specification_dict, (a=2.1,))
Closure(ClosureSubModel(2.1, 2), 3)
  
julia&gt; another_new_closure = construct_object(specification_dict, (b=π, c=2π))
Closure(ClosureSubModel(1, π), 6.283185307179586)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Parameters.jl#L396-L438">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Parameters.dict_properties-Tuple{Any}" href="#ParameterEstimocean.Parameters.dict_properties-Tuple{Any}"><code>ParameterEstimocean.Parameters.dict_properties</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">dict_properties(object)</code></pre><p>Return a dictionary with all properties of an <code>object</code> and their values, including the  <code>object</code>&#39;s type name. If any of the <code>object</code>&#39;s properties is not a numerical value but instead a composite type, then <code>dict_properties</code> is called recursively on that <code>object</code>&#39;s property returning a dictionary with all properties of that composite type. Recursion ends when properties of type <code>ParameterValue</code> are found.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Parameters.jl#L453-L461">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Parameters.new_closure_ensemble-Tuple{AbstractArray, Any, Any}" href="#ParameterEstimocean.Parameters.new_closure_ensemble-Tuple{AbstractArray, Any, Any}"><code>ParameterEstimocean.Parameters.new_closure_ensemble</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">new_closure_ensemble(closures, θ, arch=CPU())</code></pre><p>Return a new set of <code>closures</code> in which all closures that have free parameters are updated. Closures with free parameters are expected as <code>AbstractArray</code> of <code>TurbulenceClosures</code>, and this allows <code>new_closure_ensemble</code> to go through all closures in <code>closures</code> and only update the parameters for the any closure that is of type <code>AbstractArray</code>. The <code>arch</code>itecture (<code>CPU()</code> or <code>GPU()</code>) defines whethere <code>Array</code> or <code>CuArray</code> is returned.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Parameters.jl#L548-L556">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Parameters.normal_to_scaled_logit_normal-Tuple{Any, Any, Any}" href="#ParameterEstimocean.Parameters.normal_to_scaled_logit_normal-Tuple{Any, Any, Any}"><code>ParameterEstimocean.Parameters.normal_to_scaled_logit_normal</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Return a logit-normally distributed variate given the normally-distributed variate <code>X</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Parameters.jl#L90">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Parameters.scaled_logit_normal_to_normal-Tuple{Any, Any, Any}" href="#ParameterEstimocean.Parameters.scaled_logit_normal_to_normal-Tuple{Any, Any, Any}"><code>ParameterEstimocean.Parameters.scaled_logit_normal_to_normal</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Return a normally-distributed variate given the logit-normally distributed variate <code>Y</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Parameters.jl#L93">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Parameters.transform_to_constrained-Tuple{Normal, Any}" href="#ParameterEstimocean.Parameters.transform_to_constrained-Tuple{Normal, Any}"><code>ParameterEstimocean.Parameters.transform_to_constrained</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">transform_to_constrained(Π, X)</code></pre><p>Transform an &quot;unconstrained&quot;, normally-distributed variate <code>X</code> to &quot;constrained&quot; (physical) space via the map associated with the distribution <code>Π</code> of <code>Y</code>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Parameters.jl#L224-L230">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Parameters.transform_to_unconstrained-Tuple{Normal, Any}" href="#ParameterEstimocean.Parameters.transform_to_unconstrained-Tuple{Normal, Any}"><code>ParameterEstimocean.Parameters.transform_to_unconstrained</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">transform_to_unconstrained(Π, Y)</code></pre><p>Transform the &quot;constrained&quot; (physical) variate <code>Y</code> into it&#39;s unconstrained (normally-distributed) counterpart <code>X</code> through the forward map associated with <code>Π</code>.</p><p>If some mapping between <span>$Y$</span> and the normally-distributed <span>$X$</span> is defined via</p><p class="math-container">\[Y = g(X).\]</p><p>Then <code>transform_to_unconstrained</code> is the inverse <span>$X = g^{-1}(Y)$</span>. The change of variables <span>$g(X)$</span> determines the distribution <code>Π</code> of <code>Y</code>.</p><p><strong>Example</strong></p><p>The logarithm of a <code>LogNormal(μ, σ)</code> distributed variate is normally-distributed, such that the forward trasform <span>$f ≡ \exp$</span>,</p><p class="math-container">\[Y = \exp(X),\]</p><p>and the inverse trasnform is the natural logarithm <span>$f^{-1} ≡ \log$</span>,</p><p class="math-container">\[\log(Y) = X ∼ 𝒩(μ, σ).\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Parameters.jl#L185-L217">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.Parameters.update_closure_ensemble_member!-Tuple{Any, Any, Any}" href="#ParameterEstimocean.Parameters.update_closure_ensemble_member!-Tuple{Any, Any, Any}"><code>ParameterEstimocean.Parameters.update_closure_ensemble_member!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">update_closure_ensemble_member!(closures, p_ensemble, parameters)</code></pre><p>Use <code>parameters</code> to update the <code>p_ensemble</code>-th closure from and array of <code>closures</code>. The <code>p_ensemble</code>-th closure corresponds to ensemble member <code>p_ensemble</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/Parameters.jl#L522-L527">source</a></section></article><h2 id="Inverse-Problems"><a class="docs-heading-anchor" href="#Inverse-Problems">Inverse Problems</a><a id="Inverse-Problems-1"></a><a class="docs-heading-anchor-permalink" href="#Inverse-Problems" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.InverseProblems.ConcatenatedVectorNormMap" href="#ParameterEstimocean.InverseProblems.ConcatenatedVectorNormMap"><code>ParameterEstimocean.InverseProblems.ConcatenatedVectorNormMap</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ConcatenatedVectorNormMap()</code></pre><p>Forward map transformation of simulation output to a scalar by taking a naive <code>norm</code> of the difference between concatenated vectors of the observations and simulation output.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/InverseProblems.jl#L460-L466">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.InverseProblems.expand_parameters-Tuple{Any, Vector{T} where T}" href="#ParameterEstimocean.InverseProblems.expand_parameters-Tuple{Any, Vector{T} where T}"><code>ParameterEstimocean.InverseProblems.expand_parameters</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">expand_parameters(ip, θ::Vector)</code></pre><p>Convert parameters <code>θ</code> to <code>Vector{&lt;:NamedTuple}</code>, where the elements correspond to <code>ip.free_parameters</code>.</p><p><code>θ</code> may represent an ensemble of parameter sets via:</p><ul><li><code>θ::Vector{&lt;:Vector}</code> (caution: parameters must be ordered correctly!)</li><li><code>θ::Matrix</code> (caution: parameters must be ordered correctly!)</li><li><code>θ::Vector{&lt;:NamedTuple}</code> </li></ul><p>or a single parameter set if <code>θ::Vector{&lt;:Number}</code>.</p><p>If <code>length(θ)</code> is less the the number of ensemble members in <code>ip.simulation</code>, the last parameter set is copied to fill the parameter set ensemble.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/InverseProblems.jl#L271-L287">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.InverseProblems.inverting_forward_map-Tuple{Union{BatchedInverseProblem, InverseProblem}, Any}" href="#ParameterEstimocean.InverseProblems.inverting_forward_map-Tuple{Union{BatchedInverseProblem, InverseProblem}, Any}"><code>ParameterEstimocean.InverseProblems.inverting_forward_map</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">inverting_forward_map(ip::InverseProblem, X)</code></pre><p>Transform unconstrained parameters <code>X</code> into constrained, physical-space parameters <code>θ</code> and execute <code>forward_map(ip, θ)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/InverseProblems.jl#L260-L265">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.InverseProblems.transform_dataset-Tuple{Any, BatchedSyntheticObservations}" href="#ParameterEstimocean.InverseProblems.transform_dataset-Tuple{Any, BatchedSyntheticObservations}"><code>ParameterEstimocean.InverseProblems.transform_dataset</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">transform_dataset(map, batch::BatchedSyntheticObservations)</code></pre><p>Concatenate the output of <code>transform_dataset</code> of each observation in <code>batched_observations</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/InverseProblems.jl#L351-L356">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.InverseProblems.transform_dataset-Tuple{ConcatenatedOutputMap, SyntheticObservations}" href="#ParameterEstimocean.InverseProblems.transform_dataset-Tuple{ConcatenatedOutputMap, SyntheticObservations}"><code>ParameterEstimocean.InverseProblems.transform_dataset</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">transform_dataset(::ConcatenatedOutputMap, observation::SyntheticObservations)</code></pre><p>Transforms, normalizes, and concatenates data for the set of FieldTimeSeries in <code>observations</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/InverseProblems.jl#L327-L331">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.InverseProblems.transpose_model_output-Tuple{Oceananigans.Grids.AbstractGrid{var&quot;#s1553&quot;, var&quot;#s1552&quot;, var&quot;#s1551&quot;, var&quot;#s1550&quot;, Arch} where {var&quot;#s1553&quot;&lt;:AbstractFloat, var&quot;#s1552&quot;&lt;:Oceananigans.Grids.Flat, var&quot;#s1551&quot;&lt;:Oceananigans.Grids.Flat, var&quot;#s1550&quot;&lt;:Oceananigans.Grids.Bounded, Arch}, Any, Any}" href="#ParameterEstimocean.InverseProblems.transpose_model_output-Tuple{Oceananigans.Grids.AbstractGrid{var&quot;#s1553&quot;, var&quot;#s1552&quot;, var&quot;#s1551&quot;, var&quot;#s1550&quot;, Arch} where {var&quot;#s1553&quot;&lt;:AbstractFloat, var&quot;#s1552&quot;&lt;:Oceananigans.Grids.Flat, var&quot;#s1551&quot;&lt;:Oceananigans.Grids.Flat, var&quot;#s1550&quot;&lt;:Oceananigans.Grids.Bounded, Arch}, Any, Any}"><code>ParameterEstimocean.InverseProblems.transpose_model_output</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">transpose_model_output(collector_grid, time_series_collector, observations)</code></pre><p>Transpose a <code>NamedTuple</code> of 4D <code>FieldTimeSeries</code> model output collected by <code>time_series_collector</code> into a Vector of <code>SyntheticObservations</code> for each member of the observation batch.</p><p>Return a 1-vector in the case of singleton observations.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/InverseProblems.jl#L393-L400">source</a></section></article><h2 id="EnsembleKalmanInversions"><a class="docs-heading-anchor" href="#EnsembleKalmanInversions">EnsembleKalmanInversions</a><a id="EnsembleKalmanInversions-1"></a><a class="docs-heading-anchor-permalink" href="#EnsembleKalmanInversions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.EnsembleKalmanInversions.IterationSummary" href="#ParameterEstimocean.EnsembleKalmanInversions.IterationSummary"><code>ParameterEstimocean.EnsembleKalmanInversions.IterationSummary</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">IterationSummary(eki, X, forward_map_output=nothing)</code></pre><p>Return the summary for ensemble Kalman inversion <code>eki</code>  with unconstrained parameters <code>X</code> and <code>forward_map_output</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/iteration_summary.jl#L66-L71">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.EnsembleKalmanInversions.eki_objective-Tuple{Any, AbstractVector{T} where T, AbstractVector{T} where T}" href="#ParameterEstimocean.EnsembleKalmanInversions.eki_objective-Tuple{Any, AbstractVector{T} where T, AbstractVector{T} where T}"><code>ParameterEstimocean.EnsembleKalmanInversions.eki_objective</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">eki_objective(eki, θ::AbstractVector, G::AbstractVector; constrained = false)</code></pre><p>Given forward map <code>G</code> and parameters <code>θ</code>, return a tuple <code>(Φ₁, Φ₂)</code>  of terms in the ensemble Kalman inversion (<code>eki</code>) regularized objective function, where,</p><pre><code class="language-code hljs">Φ = Φ₁ + Φ₂</code></pre><p><code>Φ₁</code> measures output misfit <code>½ || Γy^(-¹/₂) * (y .- G(θ)) ||²</code> and  <code>Φ₂</code> measures prior misfit <code>½ || Γθ^(-¹/₂) * (θ .- μθ) ||²</code>, where <code>y</code> is the observation  map, <code>G(θ)</code> is the forward map, <code>Γy</code> is the observation noise covariance, <code>Γθ</code> is  the prior covariance, and <code>μθ</code> represents the prior means. Note that <code>Γ^(-¹/₂) =  inv(sqrt(Γ))</code>.</p><p>When keyword argument <code>constrained</code> is provided with <code>true</code> then input <code>θ</code> is assumed to represent constrained parameters.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/iteration_summary.jl#L18-L37">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.EnsembleKalmanInversions.find_successful_particles-NTuple{4, Any}" href="#ParameterEstimocean.EnsembleKalmanInversions.find_successful_particles-NTuple{4, Any}"><code>ParameterEstimocean.EnsembleKalmanInversions.find_successful_particles</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs"> find_successful_particles(eki, X, G, Nsample)</code></pre><p>Generate <code>Nsample</code> new particles sampled from a multivariate Normal distribution parameterized  by the ensemble mean and covariance computed based on the <code>Nθ</code> × <code>Nensemble</code> ensemble  array <code>θ</code>, under the condition that all <code>Nsample</code> particles produce successful forward map outputs.</p><p><code>G</code> (<code>size(G) =  Noutput × Nensemble</code>) is the forward map output produced by <code>θ</code>.</p><p>Returns <code>Nθ × Nsample</code> parameter <code>Array</code> and <code>Noutput × Nsample</code> forward map output <code>Array</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/resampling.jl#L126-L137">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.EnsembleKalmanInversions.resample!-Tuple{Resampler, Any, Any, Any}" href="#ParameterEstimocean.EnsembleKalmanInversions.resample!-Tuple{Resampler, Any, Any, Any}"><code>ParameterEstimocean.EnsembleKalmanInversions.resample!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">resample!(resampler::Resampler, X, G, eki)</code></pre><p>Resamples the parameters <code>X</code> of the <code>eki</code> process based on the number of failed particles.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/resampling.jl#L49-L53">source</a></section></article><h2 id="PseudoSteppingSchemes"><a class="docs-heading-anchor" href="#PseudoSteppingSchemes">PseudoSteppingSchemes</a><a id="PseudoSteppingSchemes-1"></a><a class="docs-heading-anchor-permalink" href="#PseudoSteppingSchemes" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.PseudoSteppingSchemes.eki_update-Tuple{ConstantConvergence, Any, Any, Any}" href="#ParameterEstimocean.PseudoSteppingSchemes.eki_update-Tuple{ConstantConvergence, Any, Any, Any}"><code>ParameterEstimocean.PseudoSteppingSchemes.eki_update</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">eki_update(pseudo_scheme::ConstantConvergence, Xₙ, Gₙ, eki)</code></pre><p>Implements an EKI update with an adaptive time step estimated to encourage a prescribed rate of ensemble collapse as measured by the ratio of the ensemble  covariance matrix determinants at consecutive iterations.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/PseudoSteppingSchemes.jl#L435-L441">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.PseudoSteppingSchemes.eki_update-Tuple{ParameterEstimocean.PseudoSteppingSchemes.Chada2021, Any, Any, Any}" href="#ParameterEstimocean.PseudoSteppingSchemes.eki_update-Tuple{ParameterEstimocean.PseudoSteppingSchemes.Chada2021, Any, Any, Any}"><code>ParameterEstimocean.PseudoSteppingSchemes.eki_update</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">eki_update(pseudo_scheme::ThresholdedConvergenceRatio, Xₙ, Gₙ, eki; initial_guess=nothing)</code></pre><p>Implements an EKI update with an adaptive time step estimated as suggested in Chada, Neil and Tong, Xin  &quot;Convergence Acceleration of Ensemble Kalman Inversion in Nonlinear Settings,&quot; Math. Comp. 91 (2022).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/PseudoSteppingSchemes.jl#L280-L285">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.PseudoSteppingSchemes.eki_update-Tuple{ParameterEstimocean.PseudoSteppingSchemes.Iglesias2021, Any, Any, Any}" href="#ParameterEstimocean.PseudoSteppingSchemes.eki_update-Tuple{ParameterEstimocean.PseudoSteppingSchemes.Iglesias2021, Any, Any, Any}"><code>ParameterEstimocean.PseudoSteppingSchemes.eki_update</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">eki_update(pseudo_scheme::Iglesias2021, Xₙ, Gₙ, eki)</code></pre><p>Implements an EKI update with an adaptive time step based on Iglesias et al. &quot;Adaptive  Regularization for Ensemble Kalman Inversion,&quot; Inverse Problems, 2021.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/PseudoSteppingSchemes.jl#L491-L496">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.PseudoSteppingSchemes.eki_update-Tuple{ParameterEstimocean.PseudoSteppingSchemes.Kovachki2018, Any, Any, Any}" href="#ParameterEstimocean.PseudoSteppingSchemes.eki_update-Tuple{ParameterEstimocean.PseudoSteppingSchemes.Kovachki2018, Any, Any, Any}"><code>ParameterEstimocean.PseudoSteppingSchemes.eki_update</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">eki_update(pseudo_scheme::Kovachki2018, Xₙ, Gₙ, eki)</code></pre><p>Implements an EKI update with an adaptive time step estimated as suggested in Kovachki et al. &quot;Ensemble Kalman Inversion: A Derivative-Free Technique For Machine Learning Tasks&quot; (2018).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/PseudoSteppingSchemes.jl#L190-L195">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.PseudoSteppingSchemes.eki_update-Tuple{ParameterEstimocean.PseudoSteppingSchemes.ThresholdedConvergenceRatio, Any, Any, Any}" href="#ParameterEstimocean.PseudoSteppingSchemes.eki_update-Tuple{ParameterEstimocean.PseudoSteppingSchemes.ThresholdedConvergenceRatio, Any, Any, Any}"><code>ParameterEstimocean.PseudoSteppingSchemes.eki_update</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">eki_update(pseudo_scheme::ThresholdedConvergenceRatio, Xₙ, Gₙ, eki; initial_guess=nothing)</code></pre><p>Implements an EKI update with an adaptive time step estimated by finding the first step size in the sequence Δtₖ = Δtₙ₋₁(1/2)^k with k = {0,1,2,...} that satisfies  |cov(Xₙ₊₁)|/|cov(Xₙ)| &gt; pseudo<em>scheme.cov</em>threshold, assuming the determinant ratio is a monotonically increasing function of k. If an <code>initial_guess</code> is provided, <code>Δtₙ₋₁</code> in the above sequence is replaced with <code>initial_guess</code>. If an <code>initial_guess</code> is not provided, the time step can only decrease or stay the same at future iterations with this time stepping scheme.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/PseudoSteppingSchemes.jl#L298-L308">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParameterEstimocean.PseudoSteppingSchemes.trained_gp_predict_function-Tuple{Any, Any}" href="#ParameterEstimocean.PseudoSteppingSchemes.trained_gp_predict_function-Tuple{Any, Any}"><code>ParameterEstimocean.PseudoSteppingSchemes.trained_gp_predict_function</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">trained_gp_predict_function(X, y; standardize_X=true, zscore_limit=nothing, kernel=nothing)</code></pre><p>Return a trained Gaussian Process given inputs X and outputs y.</p><p><strong>Arguments</strong></p><ul><li><code>X</code> (AbstractArray): size <code>(N_param, N_train)</code> array of training points.</li><li><code>y</code> (Vector): size <code>(N_train,)</code> array of training outputs.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>standardize_X</code> (Bool): whether to standardize the inputs for GP training and prediction.</li><li><code>zscore_limit</code> (Int): specifies the number of standard deviations outside of which </li></ul><p>all output entries and their corresponding inputs should be removed from the training data in an initial filtering step.</p><ul><li><code>kernel</code> (GaussianProcesses.Kernel): kernel to be optimized and used in the GP.</li></ul><p><strong>Returns</strong></p><ul><li><code>predict</code> (Function): a function that maps size-<code>(N_param, N_test)</code> inputs to <code>(μ, Γgp)</code>, </li></ul><p>where <code>μ</code> is an <code>(N_test,)</code> array of corresponding mean predictions and <code>Γgp</code> is the  prediction covariance matrix.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ParameterEstimocean.jl/blob/b65c3f54e96186a844b9cb8489105b4505af9300/src/PseudoSteppingSchemes.jl#L345-L362">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../public/">« Public</a><a class="docs-footer-nextpage" href="../function_index/">Function index »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Tuesday 27 September 2022 18:08">Tuesday 27 September 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
